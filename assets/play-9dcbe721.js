import{b as B,_ as G}from"./route-block-dea48b3d.js";import{_ as H,v as e,u as K,c as j,a as Q,b as X,d as Z,R as I}from"./app-9df563bc.js";const ee={class:"font-weight-bold"},te=e.createElementVNode("div",{class:"font-weight-bold"},"前价",-1),oe=e.createElementVNode("div",{class:"font-weight-bold"},"现价",-1),ne=e.createElementVNode("div",{class:"font-weight-bold"},"涨幅",-1),le=e.createElementVNode("div",{class:"font-weight-bold"},"持仓",-1),ae=e.createElementVNode("div",{class:"font-weight-bold"},"持仓总盈亏",-1),ie=e.createElementVNode("div",{class:"font-weight-bold"},"现金",-1),re=e.createElementVNode("div",{class:"font-weight-bold"},"资产总额",-1),ce={class:"font-weight-bold"},se=e.createElementVNode("div",{class:"font-weight-bold"},"现价",-1),de=e.createElementVNode("div",{class:"font-weight-bold"},"买入均价",-1),ue=e.createElementVNode("div",{class:"font-weight-bold"},"涨幅",-1),_e=e.createElementVNode("div",{class:"font-weight-bold"},"持有数",-1),fe={key:0},ve={key:1},pe=e.createElementVNode("div",{class:"mb-2 font-weight-bold"},"数量",-1),me=e.createElementVNode("span",null,"市场行情",-1),Ve=e.createElementVNode("span",null,"持仓",-1),P={__name:"play",setup(Ne){const v=e.ref("1"),n=K(),p=e.ref(!1),_=e.ref({}),c=e.ref(1),m=e.ref(0),w=e.ref(""),x=e.ref(""),V=e.ref(1),b=(a,t,d)=>{a==="BUY"?(_.value={title:`请输入您要购买股票 ${t} 的数量`,confirm:"买入",type:"BUY"},w.value="/api/stock/buy",V.value=L(d)):(_.value={title:`请输入您要卖出股票 ${t} 的数量`,confirm:"卖出",type:"SELL"},w.value="/api/stock/sell",V.value=n.userPosition.position[t].quantity),x.value=t,p.value=!0,m.value=d},h=()=>{p.value=!1,c.value=1,x.value="",m.value=0},T=()=>{Q.post(w.value,{stockName:x.value,quantity:c.value,price:m.value,time:n.currentYear}).then(a=>{if(a.data.status==="success"){const t=JSON.parse(a.data.data).data;Object.assign(n.userPosition,t),h()}else console.log(a.data.message)})};function L(a){return Math.floor(n.userPosition.balance/a)}const s=e.ref(null);function U(){const a=X();s.value=new WebSocket(`wss://${Z}/api/user/ws?token=${a}`),s.value.onopen=()=>{s.value.send("request_latest_data")},s.value.onmessage=t=>{if(t.data==="update_data"){s.value.send("request_latest_data");return}const d=JSON.parse(t.data);console.log(d.data),Object.assign(n.userPosition,d.data)},s.value.onclose=t=>{console.log("WebSocket closed:",t),setTimeout(j,I)},s.value.onerror=t=>{console.error("WebSocket Error:",t)}}e.onMounted(()=>{j(),U()});function i(a){return parseFloat(a).toFixed(2)}return(a,t)=>{const d=G,C=e.resolveComponent("v-card-title"),r=e.resolveComponent("v-list-item-title"),l=e.resolveComponent("v-list-item"),f=e.resolveComponent("v-btn"),g=e.resolveComponent("v-list"),N=e.resolveComponent("v-card"),E=e.resolveComponent("v-col"),k=e.resolveComponent("v-row"),y=e.resolveComponent("v-container"),S=e.resolveComponent("v-window-item"),$=e.resolveComponent("v-window"),R=e.resolveComponent("v-divider"),q=e.resolveComponent("v-card-subtitle"),M=e.resolveComponent("v-slider"),O=e.resolveComponent("v-sheet"),W=e.resolveComponent("v-card-text"),Y=e.resolveComponent("v-spacer"),F=e.resolveComponent("v-card-actions"),J=e.resolveComponent("v-dialog"),D=e.resolveComponent("v-icon"),A=e.resolveComponent("v-bottom-navigation");return e.openBlock(),e.createBlock(y,null,{default:e.withCtx(()=>[e.createVNode($,{modelValue:e.unref(v),"onUpdate:modelValue":t[0]||(t[0]=o=>e.isRef(v)?v.value=o:null)},{default:e.withCtx(()=>[e.createVNode(S,{value:"1"},{default:e.withCtx(()=>[e.createVNode(y,null,{default:e.withCtx(()=>[e.createVNode(d),e.createVNode(k,{class:"overflow-y-auto h-100"},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n).stock_data,(o,u)=>(e.openBlock(),e.createBlock(E,{cols:"12",md:"4",key:u},{default:e.withCtx(()=>[e.createVNode(N,null,{default:e.withCtx(()=>[e.createVNode(C,null,{default:e.withCtx(()=>[e.createElementVNode("div",ee,e.toDisplayString(u),1)]),_:2},1024),e.createVNode(g,null,{default:e.withCtx(()=>[e.createVNode(l,null,{default:e.withCtx(()=>[e.createVNode(r,{class:"d-flex justify-space-between"},{default:e.withCtx(()=>[te,e.createElementVNode("div",null,e.toDisplayString(o.previous),1)]),_:2},1024)]),_:2},1024),e.createVNode(l,null,{default:e.withCtx(()=>[e.createVNode(r,{class:"d-flex justify-space-between"},{default:e.withCtx(()=>[oe,e.createElementVNode("div",null,e.toDisplayString(o.now),1)]),_:2},1024)]),_:2},1024),e.createVNode(l,null,{default:e.withCtx(()=>[e.createVNode(r,{class:"d-flex justify-space-between"},{default:e.withCtx(()=>[ne,e.createElementVNode("div",null,e.toDisplayString(o.change),1)]),_:2},1024)]),_:2},1024),e.createVNode(l,{class:"d-flex justify-end"},{default:e.withCtx(()=>[e.createVNode(f,{variant:"flat",color:"primary",onClick:z=>b("BUY",u,o.now)},{default:e.withCtx(()=>[e.createTextVNode("买入")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e.createVNode(S,{value:"2"},{default:e.withCtx(()=>[e.createVNode(y,null,{default:e.withCtx(()=>[e.createVNode(N,{class:"mb-4",variant:"outlined"},{default:e.withCtx(()=>[e.createVNode(g,null,{default:e.withCtx(()=>[e.createVNode(l,null,{default:e.withCtx(()=>[e.createVNode(r,{class:"d-flex justify-space-between"},{default:e.withCtx(()=>[le,e.createElementVNode("div",null,e.toDisplayString(i(e.unref(n).userPosition.total_position)),1)]),_:1})]),_:1}),e.createVNode(l,null,{default:e.withCtx(()=>[e.createVNode(r,{class:"d-flex justify-space-between"},{default:e.withCtx(()=>[ae,e.createElementVNode("div",null,e.toDisplayString(i(e.unref(n).userPosition.total_profit)),1)]),_:1})]),_:1}),e.createVNode(l,null,{default:e.withCtx(()=>[e.createVNode(r,{class:"d-flex justify-space-between"},{default:e.withCtx(()=>[ie,e.createElementVNode("div",null,e.toDisplayString(i(e.unref(n).userPosition.balance)),1)]),_:1})]),_:1}),e.createVNode(l,null,{default:e.withCtx(()=>[e.createVNode(r,{class:"d-flex justify-space-between"},{default:e.withCtx(()=>[re,e.createElementVNode("div",null,e.toDisplayString(i(e.unref(n).userPosition.total_position+e.unref(n).userPosition.balance)),1)]),_:1})]),_:1})]),_:1})]),_:1}),e.createVNode(k,null,{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n).userPosition.position,(o,u)=>(e.openBlock(),e.createBlock(E,{cols:"12",md:"4",key:u},{default:e.withCtx(()=>[o.quantity!==0?(e.openBlock(),e.createBlock(N,{key:0},{default:e.withCtx(()=>[e.createVNode(C,null,{default:e.withCtx(()=>[e.createElementVNode("div",ce,e.toDisplayString(u),1)]),_:2},1024),e.createVNode(g,null,{default:e.withCtx(()=>[e.createVNode(l,null,{default:e.withCtx(()=>[e.createVNode(r,{class:"d-flex justify-space-between"},{default:e.withCtx(()=>[se,e.createElementVNode("div",null,e.toDisplayString(i(o.current_price)),1)]),_:2},1024)]),_:2},1024),e.createVNode(l,null,{default:e.withCtx(()=>[e.createVNode(r,{class:"d-flex justify-space-between"},{default:e.withCtx(()=>[de,e.createElementVNode("div",null,e.toDisplayString(i(o.purchase_avg_price)),1)]),_:2},1024)]),_:2},1024),e.createVNode(l,null,{default:e.withCtx(()=>[e.createVNode(r,{class:"d-flex justify-space-between"},{default:e.withCtx(()=>[ue,e.createElementVNode("div",null,e.toDisplayString(i(o.profit)),1)]),_:2},1024)]),_:2},1024),e.createVNode(l,null,{default:e.withCtx(()=>[e.createVNode(r,{class:"d-flex justify-space-between"},{default:e.withCtx(()=>[_e,e.createElementVNode("div",null,e.toDisplayString(o.quantity),1)]),_:2},1024)]),_:2},1024),e.createVNode(l,{class:"d-flex justify-end"},{default:e.withCtx(()=>[e.createVNode(f,{color:"primary",onClick:z=>b("SELL",u,o.current_price)},{default:e.withCtx(()=>[e.createTextVNode("卖出")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)):e.createCommentVNode("v-if",!0)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e.createVNode(J,{"onClick:outside":h,modelValue:e.unref(p),"onUpdate:modelValue":t[2]||(t[2]=o=>e.isRef(p)?p.value=o:null),width:"500"},{default:e.withCtx(()=>[e.createVNode(N,null,{default:e.withCtx(()=>[e.createVNode(C,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(_).title),1)]),_:1}),e.createVNode(R),e.createVNode(q,null,{default:e.withCtx(()=>[e.unref(_).type==="BUY"?(e.openBlock(),e.createElementBlock("div",fe,[e.createElementVNode("div",null,"您当前的余额为 "+e.toDisplayString(i(e.unref(n).userPosition.balance)),1),e.createElementVNode("div",null,"您最多可以购买 "+e.toDisplayString(e.unref(V))+" 股",1),e.createElementVNode("div",null,"当前需要花费 "+e.toDisplayString(i(e.unref(c)*e.unref(m)))+" 元",1)])):e.createCommentVNode("v-if",!0),e.unref(_).type==="SELL"?(e.openBlock(),e.createElementBlock("div",ve,[e.createElementVNode("div",null,"您当前的余额为 "+e.toDisplayString(i(e.unref(n).userPosition.balance)),1),e.createElementVNode("div",null,"您当前持有 "+e.toDisplayString(e.unref(V))+" 股",1),e.createElementVNode("div",null,"当前卖出当前数量的股票可获得 "+e.toDisplayString(i(e.unref(c)*e.unref(m)))+" 元",1)])):e.createCommentVNode("v-if",!0)]),_:1}),e.createVNode(W,null,{default:e.withCtx(()=>[e.createVNode(O,null,{default:e.withCtx(()=>[pe,e.createVNode(M,{modelValue:e.unref(c),"onUpdate:modelValue":t[1]||(t[1]=o=>e.isRef(c)?c.value=o:null),min:"1",max:e.unref(V),step:"1",type:"number",class:"align-center use-cairo-font"},{append:e.withCtx(()=>[e.createVNode(N,{elevation:"0",class:"text-center bg-transparent",style:{width:"100px"}},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(c)),1)]),_:1})]),_:1},8,["modelValue","max"])]),_:1})]),_:1}),e.createVNode(F,null,{default:e.withCtx(()=>[e.createVNode(Y),e.createVNode(f,{color:"",variant:"flat",onClick:h},{default:e.withCtx(()=>[e.createTextVNode("取消")]),_:1}),e.createVNode(f,{color:"primary",variant:"flat",onClick:T},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(_).confirm),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e.createVNode(A,{grow:""},{default:e.withCtx(()=>[e.createVNode(f,{onClick:t[3]||(t[3]=o=>v.value="1"),value:"recent"},{default:e.withCtx(()=>[e.createVNode(D,null,{default:e.withCtx(()=>[e.createTextVNode("mdi-store-clock-outline")]),_:1}),me]),_:1}),e.createVNode(f,{onClick:t[4]||(t[4]=o=>v.value="2"),value:"favorites"},{default:e.withCtx(()=>[e.createVNode(D,null,{default:e.withCtx(()=>[e.createTextVNode("mdi-cart-outline")]),_:1}),Ve]),_:1})]),_:1})]),_:1})}}};typeof B=="function"&&B(P);const he=H(P,[["__file","/home/runner/work/garden_party_stock_game/garden_party_stock_game/src/pages/play.vue"]]);export{he as default};
