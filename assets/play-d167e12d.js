import{b as B,_ as H}from"./route-block-e576d1d2.js";import{_ as K,v as e,u as Q,c as j,a as X,b as Z,d as I,R as ee}from"./app-d8d5cdcf.js";const te={class:"font-weight-bold"},oe=e.createElementVNode("div",{class:"font-weight-bold"},"前价",-1),le=e.createElementVNode("div",{class:"font-weight-bold"},"现价",-1),ne=e.createElementVNode("div",{class:"font-weight-bold"},"涨幅",-1),ae=e.createElementVNode("div",{class:"font-weight-bold"},"持仓",-1),ie=e.createElementVNode("div",{class:"font-weight-bold"},"持仓总盈亏",-1),se=e.createElementVNode("div",{class:"font-weight-bold"},"现金",-1),ce=e.createElementVNode("div",{class:"font-weight-bold"},"资产总额",-1),re={class:"font-weight-bold"},de=e.createElementVNode("div",{class:"font-weight-bold"},"现价",-1),ue=e.createElementVNode("div",{class:"font-weight-bold"},"买入均价",-1),_e=e.createElementVNode("div",{class:"font-weight-bold"},"涨幅",-1),fe=e.createElementVNode("div",{class:"font-weight-bold"},"持有数",-1),ve=e.createElementVNode("div",{class:"mb-2 font-weight-bold"},"数量",-1),pe=e.createElementVNode("span",null,"市场行情",-1),me=e.createElementVNode("span",null,"持仓",-1),T={__name:"play",setup(Ve){const f=e.ref("1"),l=Q(),v=e.ref(!1),p=e.ref({}),s=e.ref(0),w=e.ref(0),x=e.ref(""),N=e.ref(""),m=e.ref(0),y=(a,t,d)=>{a==="BUY"?(p.value={title:`请输入您要购买股票 ${t} 的数量`,confirm:"买入"},x.value="/api/stock/buy",m.value=R(d)):(p.value={title:`请输入您要卖出股票 ${t} 的数量`,confirm:"卖出"},x.value="/api/stock/sell",m.value=l.userPosition.position[t].quantity),N.value=t,v.value=!0,w.value=d},h=()=>{v.value=!1,s.value=0,N.value="",w.value=0},P=()=>{X.post(x.value,{stockName:N.value,quantity:s.value,price:w.value,time:l.currentYear}).then(a=>{if(a.data.status==="success"){const t=JSON.parse(a.data.data).data;Object.assign(l.userPosition,t),h()}else console.log(a.data.message)})};function R(a){return Math.floor(l.userPosition.balance/a)}const r=e.ref(null);function U(){const a=Z();r.value=new WebSocket(`wss://${I}/api/user/ws?token=${a}`),r.value.onopen=()=>{r.value.send("request_latest_data")},r.value.onmessage=t=>{if(t.data==="update_data"){r.value.send("request_latest_data");return}const d=JSON.parse(t.data);console.log(d.data),Object.assign(l.userPosition,d.data)},r.value.onclose=t=>{console.log("WebSocket closed:",t),setTimeout(j,ee)},r.value.onerror=t=>{console.error("WebSocket Error:",t)}}e.onMounted(()=>{j(),U()});function c(a){return parseFloat(a).toFixed(2)}return(a,t)=>{const d=H,C=e.resolveComponent("v-card-title"),i=e.resolveComponent("v-list-item-title"),n=e.resolveComponent("v-list-item"),_=e.resolveComponent("v-btn"),g=e.resolveComponent("v-list"),V=e.resolveComponent("v-card"),E=e.resolveComponent("v-col"),k=e.resolveComponent("v-row"),b=e.resolveComponent("v-container"),S=e.resolveComponent("v-window-item"),$=e.resolveComponent("v-window"),q=e.resolveComponent("v-divider"),L=e.resolveComponent("v-card-subtitle"),M=e.resolveComponent("v-text-field"),O=e.resolveComponent("v-slider"),W=e.resolveComponent("v-sheet"),F=e.resolveComponent("v-card-text"),Y=e.resolveComponent("v-spacer"),J=e.resolveComponent("v-card-actions"),A=e.resolveComponent("v-dialog"),D=e.resolveComponent("v-icon"),z=e.resolveComponent("v-bottom-navigation");return e.openBlock(),e.createBlock(b,null,{default:e.withCtx(()=>[e.createVNode($,{modelValue:e.unref(f),"onUpdate:modelValue":t[0]||(t[0]=o=>e.isRef(f)?f.value=o:null)},{default:e.withCtx(()=>[e.createVNode(S,{value:"1"},{default:e.withCtx(()=>[e.createVNode(b,null,{default:e.withCtx(()=>[e.createVNode(d),e.createVNode(k,{class:"overflow-y-auto h-100"},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l).stock_data,(o,u)=>(e.openBlock(),e.createBlock(E,{cols:"12",md:"4",key:u},{default:e.withCtx(()=>[e.createVNode(V,null,{default:e.withCtx(()=>[e.createVNode(C,null,{default:e.withCtx(()=>[e.createElementVNode("div",te,e.toDisplayString(u),1)]),_:2},1024),e.createVNode(g,null,{default:e.withCtx(()=>[e.createVNode(n,null,{default:e.withCtx(()=>[e.createVNode(i,{class:"d-flex justify-space-between"},{default:e.withCtx(()=>[oe,e.createElementVNode("div",null,e.toDisplayString(o.previous),1)]),_:2},1024)]),_:2},1024),e.createVNode(n,null,{default:e.withCtx(()=>[e.createVNode(i,{class:"d-flex justify-space-between"},{default:e.withCtx(()=>[le,e.createElementVNode("div",null,e.toDisplayString(o.now),1)]),_:2},1024)]),_:2},1024),e.createVNode(n,null,{default:e.withCtx(()=>[e.createVNode(i,{class:"d-flex justify-space-between"},{default:e.withCtx(()=>[ne,e.createElementVNode("div",null,e.toDisplayString(o.change),1)]),_:2},1024)]),_:2},1024),e.createVNode(n,{class:"d-flex justify-end"},{default:e.withCtx(()=>[e.createVNode(_,{variant:"flat",color:"primary",onClick:G=>y("BUY",u,o.now)},{default:e.withCtx(()=>[e.createTextVNode("买入")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e.createVNode(S,{value:"2"},{default:e.withCtx(()=>[e.createVNode(b,null,{default:e.withCtx(()=>[e.createVNode(V,{class:"mb-4",variant:"outlined"},{default:e.withCtx(()=>[e.createVNode(g,null,{default:e.withCtx(()=>[e.createVNode(n,null,{default:e.withCtx(()=>[e.createVNode(i,{class:"d-flex justify-space-between"},{default:e.withCtx(()=>[ae,e.createElementVNode("div",null,e.toDisplayString(c(e.unref(l).userPosition.total_position)),1)]),_:1})]),_:1}),e.createVNode(n,null,{default:e.withCtx(()=>[e.createVNode(i,{class:"d-flex justify-space-between"},{default:e.withCtx(()=>[ie,e.createElementVNode("div",null,e.toDisplayString(c(e.unref(l).userPosition.total_profit)),1)]),_:1})]),_:1}),e.createVNode(n,null,{default:e.withCtx(()=>[e.createVNode(i,{class:"d-flex justify-space-between"},{default:e.withCtx(()=>[se,e.createElementVNode("div",null,e.toDisplayString(c(e.unref(l).userPosition.balance)),1)]),_:1})]),_:1}),e.createVNode(n,null,{default:e.withCtx(()=>[e.createVNode(i,{class:"d-flex justify-space-between"},{default:e.withCtx(()=>[ce,e.createElementVNode("div",null,e.toDisplayString(c(e.unref(l).userPosition.total_position+e.unref(l).userPosition.balance)),1)]),_:1})]),_:1})]),_:1})]),_:1}),e.createVNode(k,null,{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l).userPosition.position,(o,u)=>(e.openBlock(),e.createBlock(E,{cols:"12",md:"4",key:u},{default:e.withCtx(()=>[o.quantity!==0?(e.openBlock(),e.createBlock(V,{key:0},{default:e.withCtx(()=>[e.createVNode(C,null,{default:e.withCtx(()=>[e.createElementVNode("div",re,e.toDisplayString(u),1)]),_:2},1024),e.createVNode(g,null,{default:e.withCtx(()=>[e.createVNode(n,null,{default:e.withCtx(()=>[e.createVNode(i,{class:"d-flex justify-space-between"},{default:e.withCtx(()=>[de,e.createElementVNode("div",null,e.toDisplayString(c(o.current_price)),1)]),_:2},1024)]),_:2},1024),e.createVNode(n,null,{default:e.withCtx(()=>[e.createVNode(i,{class:"d-flex justify-space-between"},{default:e.withCtx(()=>[ue,e.createElementVNode("div",null,e.toDisplayString(c(o.purchase_avg_price)),1)]),_:2},1024)]),_:2},1024),e.createVNode(n,null,{default:e.withCtx(()=>[e.createVNode(i,{class:"d-flex justify-space-between"},{default:e.withCtx(()=>[_e,e.createElementVNode("div",null,e.toDisplayString(c(o.profit)),1)]),_:2},1024)]),_:2},1024),e.createVNode(n,null,{default:e.withCtx(()=>[e.createVNode(i,{class:"d-flex justify-space-between"},{default:e.withCtx(()=>[fe,e.createElementVNode("div",null,e.toDisplayString(o.quantity),1)]),_:2},1024)]),_:2},1024),e.createVNode(n,{class:"d-flex justify-end"},{default:e.withCtx(()=>[e.createVNode(_,{color:"primary",onClick:G=>y("SELL",u,o.current_price)},{default:e.withCtx(()=>[e.createTextVNode("卖出")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)):e.createCommentVNode("v-if",!0)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e.createVNode(A,{"onClick:outside":h,modelValue:e.unref(v),"onUpdate:modelValue":t[3]||(t[3]=o=>e.isRef(v)?v.value=o:null),width:"500"},{default:e.withCtx(()=>[e.createVNode(V,null,{default:e.withCtx(()=>[e.createVNode(C,null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(p).title),1)]),_:1}),e.createVNode(q),e.createVNode(L,null,{default:e.withCtx(()=>[e.createTextVNode(" 您当前的余额为 "+e.toDisplayString(c(e.unref(l).userPosition.balance)),1)]),_:1}),e.createVNode(F,null,{default:e.withCtx(()=>[e.createVNode(W,null,{default:e.withCtx(()=>[ve,e.createVNode(O,{modelValue:e.unref(s),"onUpdate:modelValue":t[2]||(t[2]=o=>e.isRef(s)?s.value=o:null),min:"1",max:e.unref(m),step:"1",type:"number",class:"align-center use-cairo-font"},{append:e.withCtx(()=>[e.createVNode(M,{modelValue:e.unref(s),"onUpdate:modelValue":t[1]||(t[1]=o=>e.isRef(s)?s.value=o:null),"hide-details":"","single-line":"",min:"1",max:e.unref(m),step:"1",density:"compact",type:"number",style:{width:"100px"}},null,8,["modelValue","max"])]),_:1},8,["modelValue","max"])]),_:1})]),_:1}),e.createVNode(J,null,{default:e.withCtx(()=>[e.createVNode(Y),e.createVNode(_,{color:"",variant:"flat",onClick:h},{default:e.withCtx(()=>[e.createTextVNode("取消")]),_:1}),e.createVNode(_,{color:"primary",variant:"flat",onClick:P},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(p).confirm),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e.createVNode(z,{grow:""},{default:e.withCtx(()=>[e.createVNode(_,{onClick:t[4]||(t[4]=o=>f.value="1"),value:"recent"},{default:e.withCtx(()=>[e.createVNode(D,null,{default:e.withCtx(()=>[e.createTextVNode("mdi-store-clock-outline")]),_:1}),pe]),_:1}),e.createVNode(_,{onClick:t[5]||(t[5]=o=>f.value="2"),value:"favorites"},{default:e.withCtx(()=>[e.createVNode(D,null,{default:e.withCtx(()=>[e.createTextVNode("mdi-cart-outline")]),_:1}),me]),_:1})]),_:1})]),_:1})}}};typeof B=="function"&&B(T);const Ne=K(T,[["__file","/home/runner/work/garden_party_stock_game/garden_party_stock_game/src/pages/play.vue"]]);export{Ne as default};
