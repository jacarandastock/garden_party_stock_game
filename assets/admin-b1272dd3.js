import{n as K,e as v,u as P,v as Q,f as _,l as W,i as X,r as i,o as d,c as x,w as n,x as u,b as e,j as t,k as c,F as p,m as S,t as s,h as C,g as o,z as Y,A as Z,d as L}from"./index-96714ed2.js";const tt=t("thead",null,[t("tr",null,[t("th",null,"用户名"),t("th",null,"现金")])],-1),nt={class:"text-body-2"},et=t("thead",null,[t("tr",null,[t("th",null,"ID"),t("th",null,"用户名"),t("th",null,"现金"),t("th",null,"银行存款"),t("th",null,"借款额度"),t("th",null,"密码")])],-1),lt={class:"text-body-2"},at={class:"text-body-2"},st=t("br",null,null,-1),ut=t("br",null,null,-1),ot=t("thead",null,[t("tr",null,[t("th",null,"ID"),t("th",null,"用户名"),t("th",null,"状态"),t("th",null,"借款金额"),t("th",null,"借款周期"),t("th",null,"开始年份")])],-1),dt={key:0},it={key:1},ct={class:"text-body-2"},_t={class:"text-body-2"},rt=t("br",null,null,-1),ft=t("br",null,null,-1),mt=K({__name:"admin",setup(pt){const g=v("unknown"),z=P(),I=v(null),y=v(null),b=v(null),h=v(null),N=v(null);Q(async()=>{await A(),await j(),await B(),setInterval(async()=>{await A(),await j(),await B(),console.log("update records")},1e4)});async function B(){const a=await _.get("/game/admin/settlementorfinalize");h.value=a.data.is_next_settlement}const k=W(`${X}/game`,{auth:{token:localStorage.getItem("token")},transports:["websocket"]});k.on("connect",async()=>{await R()}),k.on("disconnect",()=>{console.log("socket disconnected"),setTimeout(()=>{k.connect()},5e3)}),k.on("game_status",async a=>{g.value=a.status,a.status==="pending"||a.status==="settling"||(a.status==="running"?z.year=a.current_year:a.status)}),k.on("update_data",async a=>{});async function A(){const a=await _.post("/user/all");y.value=a.data.data}async function R(){const a=await _.get("/game/get_stock_data");if(g.value=a.data.status,!(a.data.status==="pending"||a.data.status==="settling")){if(a.data.status==="running")z.year=a.data.current_year,I.value=a.data;else if(a.data.status==="finished"){const D=await _.get("/game/result");N.value=F(D.data.final_result)}}}async function T(){await _.get("/game/admin/start")}async function j(){const a=await _.get("/game/admin/loan/all");b.value=a.data.data}async function U(){const a=await _.get("/game/admin/settlement");a.data.status==="success"||a.data.status==="finished"&&(h.value=!1)}async function E(){const a=await _.get("/game/admin/finalize");N.value=F(a.data.final_result)}function F(a){return Object.entries(a).sort((D,w)=>w[1]-D[1])}return(a,D)=>{const w=i("v-table"),G=i("v-card"),O=i("v-btn"),M=i("v-card-actions"),J=i("v-chip"),$=i("v-list-item"),q=i("v-list"),r=i("v-expansion-panel-title"),f=i("v-expansion-panel-text"),m=i("v-expansion-panel"),V=i("v-expansion-panels"),H=i("v-container");return d(),x(H,{class:"fill-height align-content-start"},{default:n(()=>[u(N)?(d(),x(G,{key:0,class:"w-100 mb-3"},{default:n(()=>[e(w,null,{default:n(()=>[tt,t("tbody",null,[(d(!0),c(p,null,S(u(N),l=>(d(),c("tr",null,[t("td",null,s(l[0]),1),t("td",null,s(l[1]),1)]))),256))])]),_:1})]),_:1})):C("",!0),e(G,{class:"w-100"},{default:n(()=>[e(M,null,{default:n(()=>[e(O,{variant:"elevated",disabled:u(g)!=="pending",onClick:T},{default:n(()=>[o("开始游戏")]),_:1},8,["disabled"]),e(O,{variant:"elevated",color:"error",onClick:U,disabled:u(h)==null||u(h)!=!0||u(g)!=="running"},{default:n(()=>[o("下一年")]),_:1},8,["disabled"]),e(O,{variant:"elevated",color:"error",onClick:E,disabled:u(h)==null||u(h)!=!1},{default:n(()=>[o("结束游戏")]),_:1},8,["disabled"])]),_:1}),e(q,null,{default:n(()=>[e($,null,{default:n(()=>[o(" 游戏状态: "),e(J,null,{default:n(()=>[o(s(u(g)),1)]),_:1})]),_:1})]),_:1})]),_:1}),u(I)?(d(),x(V,{key:1,class:"mt-3"},{default:n(()=>[e(m,null,{default:n(()=>[e(r,null,{default:n(()=>[o("JSON股票数据")]),_:1}),e(f,null,{default:n(()=>[t("pre",nt,s(JSON.stringify(u(I),null,2)),1)]),_:1})]),_:1})]),_:1})):C("",!0),u(y)?(d(),x(V,{key:2,class:"mt-3"},{default:n(()=>[e(m,null,{default:n(()=>[e(r,null,{default:n(()=>[o("用户数据")]),_:1}),e(f,null,{default:n(()=>[e(w,null,{default:n(()=>[et,t("tbody",null,[(d(!0),c(p,null,S(u(y),l=>Y((d(),c("tr",null,[t("td",null,s(l.id),1),t("td",null,s(l.username),1),t("td",null,s(l.money),1),t("td",null,s(l.bank),1),t("td",null,s(l.max_loan),1),t("td",null,s(l.password),1)],512)),[[Z,!l.is_admin]])),256))])]),_:1})]),_:1})]),_:1}),e(m,null,{default:n(()=>[e(r,null,{default:n(()=>[o("JSON")]),_:1}),e(f,null,{default:n(()=>[t("pre",lt,s(JSON.stringify(u(y),null,2)),1)]),_:1})]),_:1}),e(m,null,{default:n(()=>[e(r,null,{default:n(()=>[o("CSV")]),_:1}),e(f,null,{default:n(()=>[t("pre",at,[o("ID,用户名,现金,银行存款,借款额度,密码"),st,(d(!0),c(p,null,S(u(y),l=>(d(),c(p,null,[o(s(l.id)+","+s(l.username)+","+s(l.money)+","+s(l.bank)+","+s(l.max_loan)+","+s(l.password),1),ut],64))),256))])]),_:1})]),_:1})]),_:1})):C("",!0),u(b)?(d(),x(V,{key:3,class:"mt-3"},{default:n(()=>[e(m,null,{default:n(()=>[e(r,null,{default:n(()=>[o("借款数据")]),_:1}),e(f,null,{default:n(()=>[e(w,null,{default:n(()=>[ot,t("tbody",null,[(d(!0),c(p,null,S(u(b),l=>(d(),c("tr",null,[t("td",null,s(l.id),1),t("td",null,s(l.username),1),l.is_repay?(d(),c("td",dt,[e(J,{color:"green"},{default:n(()=>[o("已还款")]),_:1})])):(d(),c("td",it,[e(J,{color:"red"},{default:n(()=>[o("未还款")]),_:1})])),t("td",null,s(l.loan),1),t("td",null,s(l.loan_period),1),t("td",null,s(l.start_year),1)]))),256))])]),_:1})]),_:1})]),_:1}),e(m,null,{default:n(()=>[e(r,null,{default:n(()=>[o("JSON")]),_:1}),e(f,null,{default:n(()=>[t("pre",ct,s(JSON.stringify(u(b),null,2)),1)]),_:1})]),_:1}),e(m,null,{default:n(()=>[e(r,null,{default:n(()=>[o("CSV")]),_:1}),e(f,null,{default:n(()=>[t("pre",_t,[o("ID,用户名,状态,借款金额,借款周期,开始年份"),rt,(d(!0),c(p,null,S(u(b),l=>(d(),c(p,null,[o(s(l.id)+","+s(l.username)+","+s(l.is_repay?"已还款":"未还款")+","+s(l.loan)+","+s(l.loan_period)+","+s(l.start_year),1),ft],64))),256))])]),_:1})]),_:1})]),_:1})):C("",!0)]),_:1})}}});typeof L=="function"&&L(mt);export{mt as default};
